<!doctype html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<title>Development in isolation</title>
	<link href='http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="node_modules/shower-ribbon/styles/screen-16x10.css">
	<link rel="stylesheet" href="styles.css">
</head>
<body class="shower list">
	<header class="caption">
		<h1>Разработка в изоляции</h1>
		<p><a href="http://alexeyraspopov.github.io">Alexey Raspopov</a>, <a href="http://datarobot.com">DataRobot</a>.</p>
	</header>

	<section class="slide">
		<h2 class="shout">Разработка в <em class="primary-accent">изоляции</em></h2>
	</section>

	<section class="slide">
		<h2 class="shout">Разработка с <em class="secondary-accent">ограничениями</em></h2>
	</section>

	<section class="slide"><img src="pictures/walkthrough.jpg" class="cover w"></section>

	<section class="slide" id="disclaimer">
		<h2>Disclaimer</h2>

		<p>Данный контент является проекцией личного опыта и переживаний автора. Может вызывать возгорание в <em>определенных</em> местах организма. Слайды наполнены кодом, местами с богомерзким React'ом, ES6 и функциональщиной.</p>

		<p>Автор не пытается обидеть чувства присутствующих, а всего лишь хочет поделиться опытом и дать пищу для размышлений.</p>
	</section>

	<section class="slide">
		<h2>Кто я?</h2>

		<ul>
			<li>5 лет профессионально двигаю кнопки на три пикселя вправо</li>
			<li>FrontEnd Dev @ <a href="http://datarobot.com">DataRobot</a></li>
			<li>Стараюсь вносить свой вклад в <a href="https://github.com/alexeyraspopov">Open Source</a></li>
			<li><em class="primary-accent">Functional</em> Programming Monk</li>
		</ul>
	</section>

	<section class="slide" id="lambda">
		<h2 class="shout code"><code>λ</code></h2>
	</section>

	<section class="slide">
		<h2 class="shout"><em class="primary-accent">Композиция</em> &mdash; серебрянная пуля<em class="secondary-accent">!</em></h2>
	</section>

	<section class="slide"><img src="pictures/omg.jpg" class="cover w"></section>

	<section class="slide">
		<h2>Композиция</h2>

		<p>(лат. <em>compositio</em> &mdash; связывание, сложение, соединение) &mdash; составление целого из частей.</p>

		<p class="next"><strong>Композиция <em class="primary-accent">функций</em></strong> &mdash; применение результата одной функции к вычислению результата другой.</p>

		<p class="next"><strong>Композиция <em class="secondary-accent">объектов</em></strong> &mdash; составление объекта на основе других.</p>
	</section>

	<section class="slide">
		<h2 class="shout code"><code><em>f(g(<span class="primary-accent">a</span>))</em></code></h2>
	</section>

	<section class="slide">
		<h2 class="shout"><span class="primary-accent">Interactive</span> & <span class="secondary-accent">Reactive</span></h2>
	</section>

	<section class="slide">
		<h2>Interactive & Reactive</h2>

		<pre>
			<code><mark class="comment">// interactive</mark></code>
			<code>const <strong class="primary-accent">data</strong> = getData(param);</code>
			<code><strong class="secondary-accent">process</strong>(<strong class="primary-accent">data</strong>);</code>
		</pre>

		<pre class="next">
			<code><mark class="comment">// reactive</mark></code>
			<code>getData(param)</code>
			<code>  .then(<strong class="primary-accent">data</strong> <mark>=></mark> <strong class="secondary-accent">process</strong>(<strong class="primary-accent">data</strong>));</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Interactive (pull)</h2>

		<pre>
			<code>function getCompanyByUser(userId) {</code>
			<code>  const <strong class="primary-accent">user</strong> = <mark>getUser</mark>(userId);</code>
			<code>  const company = <mark>getCompany</mark>(<strong class="primary-accent">user</strong>.companyId);</code>
			<code>&nbsp;</code>
			<code>  return company;</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Reactive (push)</h2>

		<pre>
			<code>function getCompanyByUser(userId) {</code>
			<code>  return <mark>getUser</mark>(userId)</code>
			<code>    .<mark class="important">then</mark>(<strong class="primary-accent">user</strong> => <mark>getCompany</mark>(<strong class="primary-accent">user</strong>.companyId));</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide"><img src="pictures/callback-hell.png" class="cover w"></section>

	<section class="slide"><img src="pictures/fox-stuck.jpg" class="cover w"></section>

	<!-- error handling -->

	<section class="slide">
		<h2>Interactive &gt; Reactive</h2>

		<ul>
			<li><em class="primary-accent">Асинхронные</em> (неблокирующие) операции требуют реактивный подход</li>
			<li>Увеличивается вложенность если данные зависимы и нужно сохранить <em class="secondary-accent">контекст</em></li>
			<li>Предполагает работу с дополнительным оператором</li>
		</ul>
	</section>

	<section class="slide">
		<h2 class="shout">А что если<em class="primary-accent">?</em></h2>
	</section>

	<section class="slide">
		<h2 class="shout"><em class="primary-accent">Асинхронные</em> операции с <em class="secondary-accent">интерактивным</em> синтаксисом!</h2>
	</section>

	<section class="slide"><img src="pictures/fox-suspicious.jpg" class="cover w"></section>

	<section class="slide">
		<h2>Сопрограмма</h2>

		<p>(англ. <em>coroutine</em>) &mdash; подпрограмма имеющая несколько <em class="primary-accent">входных</em> точек. На практике реализуется с помощью конечного автомата, который, в свою очередь, реализуется с помощью <strong class="secondary-accent">генератора</strong>.</p>
	</section>

	<section class="slide">
		<h2>Генератор</h2>

		<p>(англ. <em>generator</em>) &mdash; рутина (подпрограмма) которая может <em class="primary-accent">генерировать</em> последовательность значений (по требованию). Создает итератор.</p>

		<p><strong>Итератор</strong> (англ. <em>iterator</em>) &mdash; объект предоставляющий последовательный доступ к элементам коллекции.</p>
	</section>

	<section class="slide">
		<h2>Генератор</h2>

		<pre>
			<code>function<mark class="next">*</mark> fib() {</code>

			<div class="next">
				<code>  let [a, b] = [1, 1];</code>
				<code>&nbsp;</code>
			</div>

			<div class="next">
				<code>  while (true) {</code>
				<code class="next">    <mark>yield</mark> a;</code>
				<code class="next">    [a, b] = [b, a + b];</code>
				<code>  }</code>
				<code>}</code>
			</div>
		</pre>
	</section>

	<section class="slide">
		<h2>Использование генератора</h2>

		<pre>
			<code>const <strong class="primary-accent">gen</strong> = fib();</code>
			<code class="next">gen.next(); <mark class="comment">// { value: <mark>1</mark>, done: false }</mark></code>
			<code class="next">gen.next(); <mark class="comment">// { value: <mark>1</mark>, done: false }</mark></code>
			<code class="next">gen.next(); <mark class="comment">// { value: <mark>2</mark>, done: false }</mark></code>
			<code class="next">gen.next(); <mark class="comment">// { value: <mark>3</mark>, done: false }</mark></code>
			<code class="next">gen.next(); <mark class="comment">// { value: <mark>5</mark>, done: false }</mark></code>
			<code class="next">gen.next(); <mark class="comment">// { value: <mark>8</mark>, done: false }</mark></code>
		</pre>
	</section>

	<section class="slide">
		<h2 class="shout code">
			<code>npm i <span class="primary-accent">co</span></code>
		</h2>
	</section>

	<section class="slide">
		<h2>Interactive, <em class="primary-accent">sync</em></h2>

		<pre>
			<code>function <strong class="primary-accent">getCompanyByUser</strong>(userId) {</code>
			<code>  const <strong class="primary-accent">user</strong> = <mark>getUser</mark>(userId);</code>
			<code>  const company = <mark>getCompany</mark>(<strong class="primary-accent">user</strong>.companyId);</code>
			<code>&nbsp;</code>
			<code>  return company;</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Interactive, <em class="secondary-accent">async</em></h2>

		<pre>
			<code>const <strong class="secondary-accent">getCompanyByUser</strong> = <mark>co.wrap(function* (userId)</mark> {</code>
			<code>  const <strong class="primary-accent">user</strong> = <mark class="important">yield</mark> getUser(userId);</code>
			<code>  const company = <mark class="important">yield</mark> getCompany(<strong class="primary-accent">user</strong>.companyId);</code>
			<code>&nbsp;</code>
			<code>  return company;</code>
			<code>});</code>
		</pre>

		<p class="note">Данный код работает в современных браузерах без транспиляции.</p>
	</section>

	<section class="slide">
		<h2 class="shout code"><code><span class="primary-accent">async</span>/<span class="secondary-accent">await</span></code></h2>
	</section>

	<section class="slide">
		<h2 class="shout code">
			<code>npm i <span class="primary-accent">regenerator</span></code>
		</h2>
	</section>

	<section class="slide">
		<h2 class="shout code">
			<code>npm i <span class="primary-accent">babel</span> <br><span class="secondary-accent">babel-runtime</span></code>
		</h2>
	</section>

	<section class="slide">
		<h2>Interactive, <em class="primary-accent">sync</em></h2>

		<pre>
			<code>function <strong class="primary-accent">getCompanyByUser</strong>(userId) {</code>
			<code>  const <strong class="primary-accent">user</strong> = <mark>getUser</mark>(userId);</code>
			<code>  const company = <mark>getCompany</mark>(<strong class="primary-accent">user</strong>.companyId);</code>
			<code>&nbsp;</code>
			<code>  return company;</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Interactive, <em class="secondary-accent">async</em></h2>

		<pre>
			<code><mark>async</mark> function <strong class="secondary-accent">getCompanyByUser</strong>(userId) {</code>
			<code>  const <strong class="primary-accent">user</strong> = <mark>await</mark> getUser(userId);</code>
			<code>  const company = <mark>await</mark> getCompany(<strong class="primary-accent">user</strong>.companyId);</code>
			<code>&nbsp;</code>
			<code>  return company;</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2 class="shout code"><code><em class="primary-accent">a</em> => f(g(<em class="primary-accent">a</em>))</code></h2>
	</section>

	<section class="slide">
		<h2 class="shout code"><code><em class="secondary-accent">async</em> <em class="primary-accent">a</em> => <br>f(<em class="secondary-accent">await</em> g(<em class="primary-accent">a</em>))</code></h2>
	</section>

	<section class="slide">
		<h2>Основная идея</h2>

		<ul>
			<li>Функция выполняет одну задачу</li>
			<li class="next">Разработка начинается снизу</li>
			<li class="next">Каждая последующая функция в композиции подготавливает данные для предыдущей</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Снизу вверх</h2>

		<pre>
			<code class="next"><strong class="primary-accent">fetch</strong> = <strong class="secondary-accent">url</strong> => new Promise(...);</code>
			<code class="next"><strong class="primary-accent">getUser</strong> = <strong class="secondary-accent">userId</strong> => <strong class="primary-accent">fetch</strong>(`/users/${<strong class="secondary-accent">userId</strong>}`);</code>
			<code class="next"><strong class="primary-accent">getFriends</strong> = async <strong class="secondary-accent">ids</strong> => await* <strong class="secondary-accent">ids</strong>.map(<strong class="primary-accent">getUser</strong>);</code>
			<div class="next">
				<code><strong class="primary-accent">showFriendsByUser</strong> = async <strong class="secondary-accent">userId</strong> => {</code>
				<code class="next">  const <strong class="secondary-accent">user</strong> = await <strong class="primary-accent">getUser</strong>(<strong class="secondary-accent">userId</strong>);</code>
				<code class="next">  const <strong class="secondary-accent">friends</strong> = await <strong class="primary-accent">getFriends</strong>(<strong class="secondary-accent">user</strong>.friendsIds);</code>
				<code class="next">  return template(<strong class="secondary-accent">friends</strong>);</code>
				<code>};</code>
			</div>
		</pre>
	</section>

	<section class="slide">
		<h2>Преимущества</h2>

		<ul>
			<li>Переиспользуемость</li>
			<li>Слоистая архитектура бесплатно, без СМС</li>
			<li>Легкость написания тестов</li>
		</ul>
	</section>

	<section class="slide">
		<h2 class="shout">Хорошо<em class="primary-accent">!</em> <br>Что делать с объектами<em class="secondary-accent">?</em></h2>
	</section>

	<section class="slide">
		<h2 class="shout code">
			<code>npm i <span class="primary-accent">react</span></code>
		</h2>
	</section>

	<section class="slide">
		<h2 class="shout"><em>Сорян))</em></h2>
	</section>

	<section class="slide">
		<h2>Самый маленький компонент</h2>

		<pre>
			<code>UserInfo = ({<strong class="primary-accent">user</strong>, <strong class="primary-accent">onSelect</strong>}) =></code>
			<code class="secondary-accent">  &lt;article onClick={<strong class="primary-accent">onSelect</strong>} role="listitem"&gt;</code>
			<code>    &lt;p&gt;{<strong class="primary-accent">user</strong>.name}&lt;/p&gt;</code>
			<code>    &lt;p&gt;&lt;em&gt;{<strong class="primary-accent">user</strong>.isOnline}&lt;/em&gt;&lt;/p&gt;</code>
			<code class="secondary-accent">  &lt;/article&gt;</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Композиция</h2>

		<pre>
			<code>UsersList = ({<strong class="primary-accent">users</strong>, <strong class="primary-accent">onSelect</strong>}) =></code>
			<code>  &lt;section&gt;</code>
			<code>    {<strong class="primary-accent">users</strong>.map(<em class="secondary-accent">user</em> => </code>
			<code>      &lt;<mark>UserInfo</mark></code>
			<code>        key={<strong class="secondary-accent">user</strong>.id}</code>
			<code>        user={<strong class="secondary-accent">user</strong>}</code>
			<code>        onSelect={<strong class="primary-accent">onSelect</strong>} /&gt;)}</code>
			<code>  &lt;/section&gt;</code>
		</pre>
	</section>

	<section class="slide">
		<h2>Почему так?</h2>

		<ul>
			<li>В шаблонах никто нас не ограничивает в написании большого куска UI (привычка)</li>
			<li>Очень все плохо с DI</li>
			<li>Атрибуты только строковые</li>
		</ul>
	</section>

	<section class="slide">
		<h2>И еще на уровень выше</h2>

		<pre>
			<code>FriendsPage = ({<strong class="primary-accent">userId</strong>}) => {</code>
			<code>  const <strong class="secondary-accent">friends</strong> = getFriends(<strong class="primary-accent">userId</strong>);</code>
			<code>&nbsp;</code>
			<code>  &lt;div&gt;</code>
			<code>    &lt;h2&gt;Friends&lt;/h2&gt;</code>
			<code>    &lt;<mark>UsersList</mark> users={<strong class="secondary-accent">friends</strong>} onSelect={openPage} /&gt;</code>
			<code>  &lt;/div&gt;</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2 class="shout">Стоп<em class="primary-accent">!</em> Что<em class="secondary-accent">?</em></h2>
	</section>

	<section class="slide">
		<h2>И еще на уровень выше</h2>

		<pre>
			<code><mark>async</mark> FriendsPage = ({<strong class="primary-accent">userId</strong>}) => {</code>
			<code>  const <strong class="secondary-accent">friends</strong> = <mark>await</mark> getFriends(<strong class="primary-accent">userId</strong>);</code>
			<code>&nbsp;</code>
			<code>  &lt;div&gt;</code>
			<code>    &lt;h2&gt;Friends&lt;/h2&gt;</code>
			<code>    &lt;<mark>UsersList</mark> users={<strong class="secondary-accent">friends</strong>} onSelect={openPage} /&gt;</code>
			<code>  &lt;/div&gt;</code>
			<code>}</code>
		</pre>
	</section>

	<section class="slide">
		<h2 class="shout">
			<a href="http://worrydream.com/refs/Shannon%20-%20A%20Mathematical%20Theory%20of%20Communication.pdf">A Mathematical Theory of Communication</a>
		</h2>
	</section>

	<section class="slide"><img src="pictures/communication.png" class="cover w"></section>

	<section class="slide">
		<h2 class="shout code">
			<code>npm i <span class="primary-accent">retransmitter</span></code>
		</h2>
	</section>

	<section class="slide">
		<h2>Проекты</h2>

		<ul>
			<li><a href="https://github.com/alexeyraspopov/retransmitter">Retransmitter</a></li>
			<li><a href="https://github.com/tj/co">Co</a>, <a href="https://github.com/facebook/react">ReactJS</a></li>
			<li><a href="https://facebook.github.io/regenerator/">Regenerator</a>, <a href="https://babeljs.io">Babel</a></li>
		</ul>
	</section>

	<section class="slide">
		<h2>Ссылки</h2>

		<ul>
			<li><a href="http://worrydream.com/refs/Shannon%20-%20A%20Mathematical%20Theory%20of%20Communication.pdf">A Mathematical Theory of Communication</a></li>
			<li><a href="https://github.com/papers-we-love/papers-we-love/blob/master/design/out-of-the-tar-pit.pdf">Out of the Tar Pit</a></li>
			<li><a href="https://medium.com/@tjholowaychuk/callbacks-vs-coroutines-174f1fe66127">Callbacks vs Coroutines</a></li>
			<li><a href="https://jakearchibald.com/2014/es7-async-functions/">ES7 async functions</a></li>
		</ul>
	</section>

	<section class="slide"><img src="pictures/thanks.jpg" class="cover w"></section>

	<section class="slide">
		<h2>Спасибо</h2>

		<ul>
			<li><a href="https://twitter.com/alexeyraspopov">twitter.com/alexeyraspopov</a></li>
			<li><a href="https://github.com/alexeyraspopov">github.com/alexeyraspopov</a></li>
		</ul>

		<p>Ссылка на эти слайды &mdash; <br><a href="http://alexeyraspopov.github.io/development-in-isolation">alexeyraspopov.github.io/development-in-isolation</a></p>
	</section>

	<footer class="badge">
		<a href="https://github.com/shower/shower">Powered by Shower</a>
	</footer>

	<script src="node_modules/shower-core/shower.min.js"></script>
</body>
</html>
